var H8=Object.defineProperty;var t=(z,J)=>{for(var W in J)H8(z,W,{get:J[W],enumerable:!0,configurable:!0,set:(Z)=>J[W]=()=>Z})};var R=(z,J)=>()=>(z&&(J=z(z=0)),J);class H{#z;constructor(z=""){this.#z=z}get value(){return this.#z}get length(){return this.#z.length}isEmpty(){return this.#z.length===0}add(z){return new H(this.#z+z)}reset(){return new H}tryMatch(z){if(z.matchesRomaji(this.#z))return{type:L.COMPLETE};if(z.isPartialMatch(this.#z))return{type:L.PARTIAL};return{type:L.MISMATCH}}}var L;var J8=R(()=>{L={COMPLETE:"COMPLETE",PARTIAL:"PARTIAL",MISMATCH:"MISMATCH"}});var W8={};t(W8,{TypingSession:()=>T});class T{#z;#J;#W;#Z;#V;#X;constructor(z){this.#z=z,this.#J=new H,this.#W=new Date,this.#Z=new Map,this.#V=0,this.#X=0,this.#F()}#F(){let z=[];while(!this.#z.isCompleted()){let J=this.#z.getCurrentCharacter();if(!J||!J.isPunctuation())break;z.push(J),this.#z=this.#z.advance()}return z}get question(){return this.#z}get startTime(){return this.#W}get inputBuffer(){return this.#J}on(z,J){if(!this.#Z.has(z))this.#Z.set(z,[]);this.#Z.get(z).push(J)}#$(z,J){let W=this.#Z.get(z);if(W)W.forEach((Z)=>Z(J))}handleKeyPress(z){if(this.#z.isCompleted())return;this.#V++,this.#$("KeyPressed",{key:z,timestamp:Date.now()});let J=this.#z.getCurrentCharacter();if(!J)return;let W=this.#J.add(z);switch(W.tryMatch(J).type){case L.COMPLETE:this.#Q(J,W);break;case L.PARTIAL:this.#Y(W);break;case L.MISMATCH:this.#N(J,z);break}}#Q(z,J){this.#$("RomajiMatched",{romaji:J.value,isPartial:!1}),this.#z=this.#z.advance(),this.#J=new H,this.#$("CharacterCompleted",{character:z,duration:Date.now()-this.#W.getTime()}),this.#$("SpeechRequested",{text:z.kana});let W=this.#F();for(let Z of W)this.#$("CharacterCompleted",{character:Z,duration:Date.now()-this.#W.getTime(),skipped:!0});if(this.#z.isCompleted())this.#w()}#Y(z){this.#J=z,this.#$("RomajiMatched",{romaji:z.value,isPartial:!0})}#N(z,J){this.#X++,this.#$("CharacterMistaken",{expected:z.romaji,actual:J}),this.#J=new H}#w(){let J=new Date().getTime()-this.#W.getTime(),W=this.#V-this.#X,Z=this.#V>0?W/this.#V:1;this.#$("SessionCompleted",{totalTime:J,accuracy:Z,totalKeystrokes:this.#V,mistakes:this.#X})}getCurrentCharacter(){return this.#z.getCurrentCharacter()}getHintRomaji(){let z=this.getCurrentCharacter();if(!z||z.romaji.length===0)return"";return z.romaji[0]}getProgress(){return this.#z.getProgress()}handleDirectInput(z){if(!z||this.#z.isCompleted())return{matchedCount:0,consumedLength:0};let J=0,W=0;while(W<z.length&&!this.#z.isCompleted()){let Z=this.#z.getCurrentCharacter();if(!Z)break;let{kana:$,display:V}=Z,F=z.substring(W),w=!1,N=0;if(F.startsWith(V))w=!0,N=V.length;else if(F.startsWith($))w=!0,N=$.length;if(w){this.#V++,this.#z=this.#z.advance(),this.#$("CharacterCompleted",{character:Z,duration:Date.now()-this.#W.getTime()}),this.#$("SpeechRequested",{text:Z.kana});let _=this.#F();for(let P of _)this.#$("CharacterCompleted",{character:P,duration:Date.now()-this.#W.getTime(),skipped:!0});J++,W+=N}else break}if(this.#z.isCompleted())this.#w();return{matchedCount:J,consumedLength:W}}}var k=R(()=>{J8()});function v(z){return q[z]||[]}function Z8(z,J){return J.some((W)=>W.startsWith(z))}function $8(z,J){return J.includes(z)}function X8(z){return D8.includes(z)}function F8(z){return V8.includes(z)}function P8(z){if(z.startsWith("ch"))return"c";if(z.startsWith("sh"))return"s";if(z.startsWith("ts"))return"t";if(z.startsWith("th"))return"t";if(z.startsWith("dh"))return"d";let J=z[0];return["a","i","u","e","o"].includes(J)?null:J}function x(z){return z.length>=2&&V8.includes(z[0])}function Y8(z){if(!x(z))return[];let J=z.slice(1),W=v(J);if(W.length===0)return[];let Z=[];for(let V of W){let F=P8(V);if(F)Z.push(F+V)}let $=["xtu","ltu"];for(let V of $)for(let F of W)Z.push(V+F);return Z}var q,V8,D8;var g=R(()=>{q={"あ":["a"],"い":["i"],"う":["u"],"え":["e"],"お":["o"],"ア":["a"],"イ":["i"],"ウ":["u"],"エ":["e"],"オ":["o"],"か":["ka"],"き":["ki"],"く":["ku"],"け":["ke"],"こ":["ko"],"カ":["ka"],"キ":["ki"],"ク":["ku"],"ケ":["ke"],"コ":["ko"],"さ":["sa"],"し":["si","shi"],"す":["su"],"せ":["se"],"そ":["so"],"サ":["sa"],"シ":["si","shi"],"ス":["su"],"セ":["se"],"ソ":["so"],"た":["ta"],"ち":["ti","chi"],"つ":["tu","tsu"],"て":["te"],"と":["to"],"タ":["ta"],"チ":["ti","chi"],"ツ":["tu","tsu"],"テ":["te"],"ト":["to"],"な":["na"],"に":["ni"],"ぬ":["nu"],"ね":["ne"],"の":["no"],"ナ":["na"],"ニ":["ni"],"ヌ":["nu"],"ネ":["ne"],"ノ":["no"],"は":["ha"],"ひ":["hi"],"ふ":["hu","fu"],"へ":["he"],"ほ":["ho"],"ハ":["ha"],"ヒ":["hi"],"フ":["hu","fu"],"ヘ":["he"],"ホ":["ho"],"ま":["ma"],"み":["mi"],"む":["mu"],"め":["me"],"も":["mo"],"マ":["ma"],"ミ":["mi"],"ム":["mu"],"メ":["me"],"モ":["mo"],"や":["ya"],"ゆ":["yu"],"よ":["yo"],"ヤ":["ya"],"ユ":["yu"],"ヨ":["yo"],"ら":["ra"],"り":["ri"],"る":["ru"],"れ":["re"],"ろ":["ro"],"ラ":["ra"],"リ":["ri"],"ル":["ru"],"レ":["re"],"ロ":["ro"],"わ":["wa"],"を":["wo"],"ん":["nn","n"],"ワ":["wa"],"ヲ":["wo"],"ン":["nn","n"],"が":["ga"],"ぎ":["gi"],"ぐ":["gu"],"げ":["ge"],"ご":["go"],"ガ":["ga"],"ギ":["gi"],"グ":["gu"],"ゲ":["ge"],"ゴ":["go"],"ざ":["za"],"じ":["zi","ji"],"ず":["zu"],"ぜ":["ze"],"ぞ":["zo"],"ザ":["za"],"ジ":["zi","ji"],"ズ":["zu"],"ゼ":["ze"],"ゾ":["zo"],"だ":["da"],"ぢ":["di"],"づ":["du","dzu"],"で":["de"],"ど":["do"],"ダ":["da"],"ヂ":["di"],"ヅ":["du","dzu"],"デ":["de"],"ド":["do"],"ば":["ba"],"び":["bi"],"ぶ":["bu"],"べ":["be"],"ぼ":["bo"],"バ":["ba"],"ビ":["bi"],"ブ":["bu"],"ベ":["be"],"ボ":["bo"],"ぱ":["pa"],"ぴ":["pi"],"ぷ":["pu"],"ぺ":["pe"],"ぽ":["po"],"パ":["pa"],"ピ":["pi"],"プ":["pu"],"ペ":["pe"],"ポ":["po"],"きゃ":["kya"],"きゅ":["kyu"],"きょ":["kyo"],"しゃ":["sya","sha"],"しゅ":["syu","shu"],"しょ":["syo","sho"],"ちゃ":["tya","cha"],"ちゅ":["tyu","chu"],"ちょ":["tyo","cho"],"にゃ":["nya"],"にゅ":["nyu"],"にょ":["nyo"],"ひゃ":["hya"],"ひゅ":["hyu"],"ひょ":["hyo"],"みゃ":["mya"],"みゅ":["myu"],"みょ":["myo"],"りゃ":["rya"],"りゅ":["ryu"],"りょ":["ryo"],"ぎゃ":["gya"],"ぎゅ":["gyu"],"ぎょ":["gyo"],"じゃ":["zya","ja","jya"],"じゅ":["zyu","ju","jyu"],"じょ":["zyo","jo","jyo"],"びゃ":["bya"],"びゅ":["byu"],"びょ":["byo"],"ぴゃ":["pya"],"ぴゅ":["pyu"],"ぴょ":["pyo"],"っ":["xtu","ltu","xtsu","ltsu"],"ッ":["xtu","ltu","xtsu","ltsu"],"ぁ":["xa","la"],"ぃ":["xi","li"],"ぅ":["xu","lu"],"ぇ":["xe","le"],"ぉ":["xo","lo"],"ゃ":["xya","lya"],"ゅ":["xyu","lyu"],"ょ":["xyo","lyo"],"、":[","],"。":["."],"？":["?"],"！":["!"],"「":["["],"」":["]"],"ー":["-"],"〜":["~"],"ティ":["thi","texi","teli"],"ディ":["dhi","dexi","deli"],"ファ":["fa","huxa","hula"],"フィ":["fi","huxi","huli"],"フェ":["fe","huxe","hule"],"フォ":["fo","huxo","hulo"],"ウィ":["wi","uxi","uli"],"ウェ":["we","uxe","ule"],"ウォ":["wo","uxo","ulo"],"ヴァ":["va","vuxa"],"ヴィ":["vi","vuxi"],"ヴ":["vu"],"ヴェ":["ve","vuxe"],"ヴォ":["vo","vuxo"],"ゐ":["wi"],"ヰ":["wi"],"ゑ":["we"],"ヱ":["we"]};V8=["っ","ッ"],D8=["、","。","？","！","「","」","（","）","(",")","ー","〜","～","*"]});class K{#z;#J;#W;#Z;constructor(z,J=O.PENDING,W=null,Z=null){if(this.#z=z,this.#Z=Z||z,W)this.#J=W;else if(x(z))this.#J=Y8(z);else this.#J=v(z);this.#W=J}get kana(){return this.#z}get romaji(){return this.#J}get state(){return this.#W}get display(){return this.#Z}setCurrent(){return new K(this.#z,O.CURRENT,this.#J,this.#Z)}setCompleted(){return new K(this.#z,O.COMPLETED,this.#J,this.#Z)}matchesRomaji(z){return $8(z,this.#J)}isPartialMatch(z){return Z8(z,this.#J)}isPunctuation(){return X8(this.#z)}matchesKana(z){return this.#z===z}matchesDisplay(z){return this.#Z===z}}var O;var Q8=R(()=>{g();O={PENDING:"pending",CURRENT:"current",COMPLETED:"completed"}});var N8={};t(N8,{Question:()=>G});function U8(z,J){if(J>=z.length)return null;if(J+1<z.length){let W=z.slice(J,J+2);if(w8.includes(W)||q[W])return W}return z[J]}function O8(z){let J=v(z);if(J.length===0)return!1;let W=["a","i","u","e","o"];return J.some((Z)=>!W.includes(Z[0]))}function K8(z){let J=[],W=0;while(W<z.length){if(F8(z[W])&&W+1<z.length){let Z=U8(z,W+1);if(Z&&O8(Z)){J.push(z[W]+Z),W+=1+Z.length;continue}}if(W+1<z.length){let Z=z.slice(W,W+2);if(w8.includes(Z)||q[Z]){J.push(Z),W+=2;continue}}J.push(z[W]),W+=1}return J}function A8(z){return z==="ん"||z==="ン"}function R8(z){return M8.includes(z)}class G{#z;#J;#W;constructor(z,J,W=0){this.#z=z,this.#J=J,this.#W=W}static fromText(z){let W=K8(z).map((Z,$,V)=>{let F=null;if(A8(Z))if($===V.length-1)F=["n","nn"];else{let N=V[$+1];if(R8(N))F=["nn","n'"]}let w=new K(Z,O.PENDING,F);return $===0?w.setCurrent():w});return new G(z,W,0)}static fromQuestionData(z){let J=z.characters.map((Z,$)=>{let V=new K(Z.kana,O.PENDING,Z.romaji,Z.display);return $===0?V.setCurrent():V}),W=new G(z.text,J,0);return W._id=z.id,W._displayCharacters=z.characters,W._source=z.source,W._metadata=z.metadata,W}get id(){return this._id}get displayCharacters(){return this._displayCharacters}get source(){return this._source}get metadata(){return this._metadata}get text(){return this.#z}get characters(){return this.#J}get currentIndex(){return this.#W}getCurrentCharacter(){if(this.#W>=this.#J.length)return null;return this.#J[this.#W]}advance(){if(this.isCompleted())return this;let z=this.#J.map((J,W)=>{if(W===this.#W)return J.setCompleted();else if(W===this.#W+1)return J.setCurrent();return J});return new G(this.#z,z,this.#W+1)}isCompleted(){return this.#W>=this.#J.length}getProgress(){if(this.#J.length===0)return 1;return this.#W/this.#J.length}}var w8,M8;var E=R(()=>{Q8();g();w8=["きゃ","きゅ","きょ","しゃ","しゅ","しょ","ちゃ","ちゅ","ちょ","にゃ","にゅ","にょ","ひゃ","ひゅ","ひょ","みゃ","みゅ","みょ","りゃ","りゅ","りょ","ぎゃ","ぎゅ","ぎょ","じゃ","じゅ","じょ","びゃ","びゅ","びょ","ぴゃ","ぴゅ","ぴょ","キャ","キュ","キョ","シャ","シュ","ショ","チャ","チュ","チョ","ニャ","ニュ","ニョ","ヒャ","ヒュ","ヒョ","ミャ","ミュ","ミョ","リャ","リュ","リョ","ギャ","ギュ","ギョ","ジャ","ジュ","ジョ","ビャ","ビュ","ビョ","ピャ","ピュ","ピョ","ティ","ディ","ファ","フィ","フェ","フォ","ウィ","ウェ","ウォ","ヴァ","ヴィ","ヴェ","ヴォ"];M8=["な","に","ぬ","ね","の","にゃ","にゅ","にょ","あ","い","う","え","お","や","ゆ","よ","ナ","ニ","ヌ","ネ","ノ","ニャ","ニュ","ニョ","ア","イ","ウ","エ","オ","ヤ","ユ","ヨ"]});class I{#z;#J;#W;constructor(z,J){this.#z=J,this.#J=new Set,this.#W=z}getState(){return this.#z}dispatch(z){if(!z||typeof z.type!=="string")throw Error("Action must have a type property");let J=this.#z;if(this.#z=this.#W(this.#z,z),J!==this.#z)this.#Z(z)}subscribe(z){if(typeof z!=="function")throw Error("Listener must be a function");return this.#J.add(z),()=>{this.#J.delete(z)}}#Z(z){this.#J.forEach((J)=>{try{J(this.#z,z)}catch(W){console.error("Store listener error:",W)}})}getListenerCount(){return this.#J.size}}var Y={SET_PRACTICE_MODE:"SET_PRACTICE_MODE",SET_INPUT_MODE:"SET_INPUT_MODE",TOGGLE_ROMAJI_HINT:"TOGGLE_ROMAJI_HINT",TOGGLE_KEYBOARD:"TOGGLE_KEYBOARD",SET_FILTER:"SET_FILTER",START_LOADING:"START_LOADING",LOAD_QUESTION_SUCCESS:"LOAD_QUESTION_SUCCESS",LOAD_QUESTION_FAILURE:"LOAD_QUESTION_FAILURE",COMPLETE_SESSION:"COMPLETE_SESSION",RESET_SESSION:"RESET_SESSION"},Q={setPracticeMode:(z)=>({type:Y.SET_PRACTICE_MODE,payload:z}),setInputMode:(z)=>({type:Y.SET_INPUT_MODE,payload:z}),toggleRomajiHint:()=>({type:Y.TOGGLE_ROMAJI_HINT}),toggleKeyboard:()=>({type:Y.TOGGLE_KEYBOARD}),setFilter:(z,J)=>({type:Y.SET_FILTER,payload:{key:z,value:J}}),startLoading:()=>({type:Y.START_LOADING}),loadQuestionSuccess:(z)=>({type:Y.LOAD_QUESTION_SUCCESS,payload:z}),loadQuestionFailure:(z)=>({type:Y.LOAD_QUESTION_FAILURE,payload:z}),completeSession:(z)=>({type:Y.COMPLETE_SESSION,payload:z}),resetSession:()=>({type:Y.RESET_SESSION})};function e(z,J){switch(J.type){case Y.SET_PRACTICE_MODE:return{...z,practiceMode:J.payload};case Y.SET_INPUT_MODE:return{...z,inputMode:J.payload};case Y.TOGGLE_ROMAJI_HINT:return{...z,uiSettings:{...z.uiSettings,showRomajiHint:!z.uiSettings.showRomajiHint}};case Y.TOGGLE_KEYBOARD:return{...z,uiSettings:{...z.uiSettings,showKeyboard:!z.uiSettings.showKeyboard}};case Y.SET_FILTER:return{...z,filters:{...z.filters,[J.payload.key]:J.payload.value}};case Y.START_LOADING:return{...z,status:"loading",error:null};case Y.LOAD_QUESTION_SUCCESS:return{...z,status:"practicing",currentQuestion:J.payload,error:null};case Y.LOAD_QUESTION_FAILURE:return{...z,status:"error",error:J.payload};case Y.COMPLETE_SESSION:return{...z,status:"completed",result:J.payload};case Y.RESET_SESSION:return{...z,status:"idle",currentQuestion:null,result:null,error:null};default:return z}}var z8={practiceMode:"question",inputMode:"romaji",uiSettings:{showRomajiHint:!0,showKeyboard:!0},filters:{jlpt:"all"},status:"idle",currentQuestion:null,result:null,error:null};k();class U{static get id(){throw Error("Must implement static id getter")}static get displayName(){throw Error("Must implement static displayName getter")}static get description(){return""}static get requiresQuestionLoader(){return!1}static get supportedInputModes(){return["romaji","direct"]}constructor(z){if(new.target===U)throw Error("PracticeMode is abstract and cannot be instantiated directly");this.store=z.store,this.questionLoader=z.questionLoader,this.speechService=z.speechService,this.session=null}async initialize(){throw Error("Must implement initialize()")}async loadNextQuestion(){throw Error("Must implement loadNextQuestion()")}createSession(z){return this.session=new T(z),this.session}setupSessionListeners(z){z.on("SpeechRequested",(J)=>{this.speechService?.speak(J.text)}),z.on("SessionCompleted",(J)=>{this.onSessionCompleted(J)}),z.on("CharacterMistaken",(J)=>{this.onCharacterMistaken(J)})}onCharacterCompleted(z){}onSessionCompleted(z){this.store.dispatch(Q.completeSession(z))}onCharacterMistaken(z){}dispose(){this.session=null}getUIConfig(){return{showFilters:!1,showSourceLink:!1}}}E();class y extends U{static get id(){return"question"}static get displayName(){return"題庫模式"}static get description(){return"從卡片庫中隨機選取例句練習"}static get requiresQuestionLoader(){return!0}async initialize(){if(!this.questionLoader)throw Error("QuestionMode requires a QuestionLoader");if(!this.questionLoader.isLoaded())this.store.dispatch(Q.startLoading()),await this.questionLoader.load()}async loadNextQuestion(){let J=this.store.getState().filters,W=this.questionLoader.getRandomQuestion(J);if(!W)throw Error("找不到符合條件的題目");return this.store.dispatch(Q.loadQuestionSuccess(W)),G.fromQuestionData(W)}getUIConfig(){return{showFilters:!0,showSourceLink:!0}}}E();var h=["あいうえお","かきくけこ","さしすせそ","たちつてと","なにぬねの","はひふへほ","まみむめも","やゆよ","らりるれろ","わをん","がぎぐげご","ざじずぜぞ","だぢづでど","ばびぶべぼ","ぱぴぷぺぽ","きゃきゅきょ","しゃしゅしょ","ちゃちゅちょ","こんにちは","ありがとう","おはよう","さようなら","いただきます","ごちそうさま"];class m extends U{static get id(){return"kana"}static get displayName(){return"假名模式"}static get description(){return"練習基礎假名輸入"}static get requiresQuestionLoader(){return!1}async initialize(){}async loadNextQuestion(){let z=this.#z();return this.store.dispatch(Q.loadQuestionSuccess({text:z})),G.fromText(z)}#z(){let z=Math.floor(Math.random()*h.length);return h[z]}getUIConfig(){return{showFilters:!1,showSourceLink:!1}}static getPracticeTexts(){return[...h]}}class _8{#z=new Map;#J=null;#W=null;constructor(){this.register(y),this.register(m)}register(z){if(!z.id)throw Error("Mode class must have a static id property");this.#z.set(z.id,z)}unregister(z){this.#z.delete(z)}setDependencies(z){this.#W=z}getAvailableModes(){return Array.from(this.#z.values()).map((z)=>({id:z.id,displayName:z.displayName,description:z.description}))}hasMode(z){return this.#z.has(z)}getModeClass(z){return this.#z.get(z)}async switchMode(z){if(!this.#W)throw Error("Dependencies not set. Call setDependencies() first.");if(this.#J)this.#J.dispose(),this.#J=null;let J=this.#z.get(z);if(!J)throw Error(`Unknown mode: ${z}`);return this.#J=new J(this.#W),await this.#J.initialize(),this.#J}getCurrentMode(){return this.#J}getCurrentModeId(){if(!this.#J)return null;return this.#J.constructor.id}reset(){if(this.#J)this.#J.dispose(),this.#J=null;this.#W=null}}var D=new _8;class M{#z=null;#J=null;constructor(){if(new.target===M)throw Error("InputHandler is abstract and cannot be instantiated directly");this.isActive=!1}setSession(z){this.#z=z}get session(){return this.#z}setUpdateCallback(z){this.#J=z}triggerUpdate(){if(this.#J)this.#J()}activate(){this.isActive=!0}deactivate(){this.isActive=!1}dispose(){this.deactivate(),this.#z=null,this.#J=null}updateHighlight(){}}class p extends M{#z;#J=null;constructor(z=null){super();this.#z=z}activate(){if(this.deactivate(),super.activate(),typeof document>"u")return;this.#J=this.#W.bind(this),document.addEventListener("keydown",this.#J)}deactivate(){if(super.deactivate(),this.#J&&typeof document<"u")document.removeEventListener("keydown",this.#J),this.#J=null}#W(z){if(!this.isActive||!this.session)return;if(z.ctrlKey||z.altKey||z.metaKey)return;if(z.key.length!==1)return;z.preventDefault();let J=z.key.toLowerCase();this.#z?.showKeyPress(J),this.session.handleKeyPress(J),this.triggerUpdate()}updateHighlight(){if(!this.session||!this.#z)return;let z=this.session.getHintRomaji(),J=null;if(z){for(let W of z)if(/[a-z]/i.test(W)){J=W.toLowerCase();break}}this.#z.highlightKey(J)}dispose(){this.deactivate(),this.#z?.highlightKey(null),super.dispose()}setKeyboardRenderer(z){this.#z=z}}class d extends M{#z;#J=null;#W=null;constructor(z=null){super();this.#z=z}setInputElement(z){this.#z=z}activate(){if(this.deactivate(),super.activate(),!this.#z){console.warn("DirectInputHandler: Input element not set");return}this.#J=this.#Z.bind(this),this.#W=this.#Z.bind(this),this.#z.addEventListener("input",this.#J),this.#z.addEventListener("compositionend",this.#W),this.#z.value="",setTimeout(()=>{this.#z?.focus()},100)}deactivate(){if(super.deactivate(),this.#z){if(this.#J)this.#z.removeEventListener("input",this.#J);if(this.#W)this.#z.removeEventListener("compositionend",this.#W)}this.#J=null,this.#W=null}#Z(z){if(!this.isActive||!this.session||!this.#z)return;let J=this.#z.value;if(!J)return;let W=this.session.handleDirectInput(J);if(W.matchedCount>0)this.#z.value=J.substring(W.consumedLength),this.triggerUpdate()}dispose(){if(this.deactivate(),this.#z)this.#z.value="";super.dispose()}focus(){this.#z?.focus()}getInputElement(){return this.#z}}class l{#z;#J;constructor(z={}){this.#z=z.keyboardRenderer||null,this.#J=z.mobileInputElement||null}setKeyboardRenderer(z){this.#z=z}setMobileInputElement(z){this.#J=z}create(z){switch(z){case"romaji":return new p(this.#z);case"direct":return new d(this.#J);default:throw Error(`Unknown input mode: ${z}`)}}static getSupportedModes(){return["romaji","direct"]}}class u{#z;constructor(z){this.#z=z}render(z,J=null){if(!this.#z||!z)return;let W=z.characters,Z;if(J?.characters)Z=J.characters.map(($,V)=>{let F=W[V];return`<span class="char ${F?`char-${F.state}`:"char-pending"}" data-index="${V}">${$.display}</span>`}).join("");else Z=W.map(($,V)=>{return`<span class="char ${`char-${$.state}`}" data-index="${V}">${$.kana}</span>`}).join("");this.#z.innerHTML=Z,this.#J(z.currentIndex)}#J(z){let J=this.#z?.querySelector(`[data-index="${z}"]`);if(!J)return;let W=this.#z.parentElement?.getBoundingClientRect();if(!W)return;let Z=W.width/3,$=J.offsetLeft,V=Math.max(0,$-Z);this.#z.style.transform=`translateX(-${V}px)`}clear(){if(this.#z)this.#z.innerHTML="",this.#z.style.transform=""}getContainer(){return this.#z}}class c{#z;constructor(z){this.#z=z}render(z){if(!this.#z||!z)return;let W=z.characters.map((Z,$)=>{let V=`romaji-${Z.state}`,F=Z.romaji[0]||"";return`<span class="romaji ${V}" data-index="${$}">${F}</span>`}).join("");this.#z.innerHTML=W,this.#J(z.currentIndex)}#J(z){let J=this.#z?.querySelector(`[data-index="${z}"]`);if(!J)return;let W=this.#z.parentElement?.getBoundingClientRect();if(!W)return;let Z=W.width/3,$=J.offsetLeft,V=Math.max(0,$-Z);this.#z.style.transform=`translateX(-${V}px)`}clear(){if(this.#z)this.#z.innerHTML="",this.#z.style.transform=""}getContainer(){return this.#z}}var j={"zh-TW":{pageTitle:"日文輸入練習",siteName:"日文學習卡片盒",backToCards:"← 返回卡片盒",mobileNotice:"請使用桌面瀏覽器搭配實體鍵盤進行練習",backButton:"返回卡片盒",jlptLabel:"JLPT 等級：",jlptAll:"全部",nextQuestion:"下一題",mobileMode:"手機模式",keyboardMode:"鍵盤模式",kanaMode:"假名模式",questionMode:"題庫模式",hideHint:"隱藏提示",showHint:"顯示提示",inputHint:"使用實體鍵盤輸入羅馬拼音",mobileInputPlaceholder:"ここに入力",mobileInputHint:"日本語入力で直接かなを入力",loading:"載入中...",loadingQuestions:"載入題庫中...",complete:"完成！",accuracy:"準確率",time:"時間",keystrokes:"按鍵數",viewSourceCard:"查看來源卡片：",retry:"重新開始",initFailed:"應用程式初始化失敗",reload:"重新載入"},en:{pageTitle:"Japanese Typing Practice",siteName:"Japanese Learning Cards",backToCards:"← Back to Cards",mobileNotice:"Please use a desktop browser with a physical keyboard",backButton:"Back to Cards",jlptLabel:"JLPT Level:",jlptAll:"All",nextQuestion:"Next",mobileMode:"Mobile Mode",keyboardMode:"Keyboard Mode",kanaMode:"Kana Mode",questionMode:"Question Mode",hideHint:"Hide Hint",showHint:"Show Hint",inputHint:"Type romaji using your keyboard",mobileInputPlaceholder:"Type here",mobileInputHint:"Input kana directly using Japanese IME",loading:"Loading...",loadingQuestions:"Loading questions...",complete:"Complete!",accuracy:"Accuracy",time:"Time",keystrokes:"Keystrokes",viewSourceCard:"View source card:",retry:"Retry",initFailed:"Failed to initialize application",reload:"Reload"},ja:{pageTitle:"日本語入力練習",siteName:"日本語学習カード",backToCards:"← カードへ戻る",mobileNotice:"デスクトップブラウザと物理キーボードをご使用ください",backButton:"カードへ戻る",jlptLabel:"JLPTレベル：",jlptAll:"すべて",nextQuestion:"次へ",mobileMode:"スマホモード",keyboardMode:"キーボードモード",kanaMode:"かなモード",questionMode:"問題モード",hideHint:"ヒントを隠す",showHint:"ヒントを表示",inputHint:"キーボードでローマ字を入力",mobileInputPlaceholder:"ここに入力",mobileInputHint:"日本語入力で直接かなを入力",loading:"読み込み中...",loadingQuestions:"問題を読み込み中...",complete:"完了！",accuracy:"正確率",time:"時間",keystrokes:"キー数",viewSourceCard:"ソースカードを見る：",retry:"やり直す",initFailed:"アプリの初期化に失敗しました",reload:"再読み込み"}};var G8="practice_language",A=["zh-TW","en","ja"],b="zh-TW";class B8{#z;#J=[];constructor(){this.#z=this.#W()}#W(){if(typeof window>"u")return b;let z=localStorage.getItem(G8);if(z&&A.includes(z))return z;let W=new URLSearchParams(window.location.search).get("lang");if(W&&A.includes(W))return W;let Z=navigator.language||navigator.userLanguage;if(Z){if(A.includes(Z))return Z;let $=Z.split("-")[0],V=A.find((F)=>F.startsWith($)||F===$);if(V)return V}return b}getLanguage(){return this.#z}getSupportedLanguages(){return[...A]}setLanguage(z){if(!A.includes(z)){console.warn(`Unsupported language: ${z}`);return}if(this.#z=z,typeof localStorage<"u")localStorage.setItem(G8,z);if(typeof window<"u"){let J=new URL(window.location);if(z!==b)J.searchParams.set("lang",z);else J.searchParams.delete("lang");window.history.replaceState({},"",J)}this.#J.forEach((J)=>J(z))}t(z,J={}){let W=j[this.#z];if(!W)return console.warn(`No translations for language: ${this.#z}`),z;let Z=W[z];if(Z===void 0){if(Z=j[b]?.[z],Z===void 0)return console.warn(`Missing translation for key: ${z}`),z}return Object.keys(J).forEach(($)=>{Z=Z.replace(new RegExp(`{{${$}}}`,"g"),J[$])}),Z}subscribe(z){return this.#J.push(z),()=>{let J=this.#J.indexOf(z);if(J>-1)this.#J.splice(J,1)}}getLanguageName(z){return{"zh-TW":"繁體中文",en:"English",ja:"日本語"}[z]||z}}var X=new B8;class o{#z;#J;#W=null;constructor(z,J=""){this.#z=z,this.#J=J}setNextQuestionCallback(z){this.#W=z}render(z,J=null){if(!this.#z)return;let W=Math.round(z.accuracy*100),Z=(z.totalTime/1000).toFixed(1),$="";if(J?.source)$=`
        <a href="${this.#J+J.source.path}" class="source-link" target="_blank">
          ${X.t("viewSourceCard")}${J.source.title} →
        </a>
      `;let V=this.#W?`<button class="next-btn" id="next-question-btn">${X.t("nextQuestion")}</button>`:"";this.#z.innerHTML=`
      <div class="result-box">
        <h2>${X.t("complete")}</h2>
        <div class="result-stats">
          <div class="stat">
            <span class="stat-value">${W}%</span>
            <span class="stat-label">${X.t("accuracy")}</span>
          </div>
          <div class="stat">
            <span class="stat-value">${Z}s</span>
            <span class="stat-label">${X.t("time")}</span>
          </div>
          <div class="stat">
            <span class="stat-value">${z.totalKeystrokes}</span>
            <span class="stat-label">${X.t("keystrokes")}</span>
          </div>
        </div>
        ${$}
        <div class="result-actions">
          ${V}
          <button class="retry-btn" onclick="location.reload()">${X.t("retry")}</button>
        </div>
      </div>
    `,this.#z.style.display="flex",this.#Z()}#Z(){if(!this.#W)return;let z=this.#z?.querySelector("#next-question-btn");if(z)z.addEventListener("click",()=>this.#W())}hide(){if(this.#z)this.#z.style.display="none"}dispose(){this.#W=null}getContainer(){return this.#z}}class i{#z;#J;#W;#Z;constructor(z,J={}){this.#z=z,this.#J=J.successClass||"flash-success",this.#W=J.errorClass||"flash-error",this.#Z=J.duration||200}flashSuccess(){this.#V(this.#J)}flashError(){this.#V(this.#W)}#V(z){if(!this.#z)return;this.#z.classList.add(z),setTimeout(()=>{this.#z?.classList.remove(z)},this.#Z)}setContainer(z){this.#z=z}getContainer(){return this.#z}}class s{#z;#J;constructor(z){this.#z=z,this.#J=null}highlightKey(z){if(this.#J)this.#J.classList.remove("key-target");if(!z){this.#J=null;return}let J=this.#z.querySelector(`[data-key="${z}"]`);if(J)J.classList.add("key-target"),this.#J=J}showKeyPress(z){let J=this.#z.querySelector(`[data-key="${z}"]`);if(!J)return;J.classList.add("key-pressed"),setTimeout(()=>{J.classList.remove("key-pressed")},100)}clearHighlights(){this.#z.querySelectorAll(".key").forEach((J)=>{J.classList.remove("key-target","key-pressed")}),this.#J=null}}class S{constructor(z){if(!z){let W=window.location.pathname.match(/^(.*?)\/[^\/]+\/?$/);z=`${W?W[1]:""}/data/questions.json`}this.dataUrl=z,this.basePath=this.dataUrl.replace(/\/[^\/]+$/,""),this.questionBank=null,this.index=null,this.loadedBundles=new Set,this.loadingPromises=new Map,this.recentIds=new Set,this.maxRecentHistory=10,this.useProgressiveLoading=!1}async loadIndex(){if(this.index)return this.index;let z=`${this.basePath}/questions-index.json`;try{let J=await fetch(z);if(!J.ok)return null;return this.index=await J.json(),console.log(`索引檔載入完成: ${Object.keys(this.index.bundles).length} 個分包`),this.index}catch(J){return console.log("索引檔不存在，使用傳統載入模式"),null}}async loadInitial(){let z=await this.loadIndex();if(z)return this.useProgressiveLoading=!0,this.questionBank={version:z.version,generated:z.generated,questions:[],stats:z.stats},await this.loadBundle("init"),console.log(`初始載入完成: ${this.questionBank.questions.length} 題`),this.questionBank;return this.loadLegacy()}async loadBundle(z){if(this.loadedBundles.has(z))return;if(this.loadingPromises.has(z))return this.loadingPromises.get(z);if(!this.index)throw Error("索引檔尚未載入");let J=this.index.bundles[z];if(!J){console.warn(`分包不存在: ${z}`);return}let W=`${this.basePath}/${J.path}`,Z=(async()=>{try{let $=await fetch(W);if(!$.ok)throw Error(`載入分包失敗: ${$.status}`);let V=await $.json();this.mergeQuestions(V.questions),this.loadedBundles.add(z),console.log(`分包載入完成: ${z} (${V.questions.length} 題)`)}catch($){throw console.error(`載入分包 ${z} 失敗:`,$),$}finally{this.loadingPromises.delete(z)}})();return this.loadingPromises.set(z,Z),Z}mergeQuestions(z){if(!this.questionBank)return;let J=new Set(this.questionBank.questions.map((Z)=>Z.id)),W=z.filter((Z)=>!J.has(Z.id));this.questionBank.questions.push(...W)}async loadInBackground(z){for(let J of z)if(!this.loadedBundles.has(J)&&this.index?.bundles[J])try{await this.loadBundle(J)}catch(W){console.warn(`背景載入 ${J} 失敗，稍後重試`)}}isLevelLoaded(z){return this.loadedBundles.has(z)}getLoadingStatus(){let z=this.index?Object.keys(this.index.bundles).length:1;return{loadedBundles:[...this.loadedBundles],totalQuestions:this.questionBank?.questions.length||0,isFullyLoaded:this.loadedBundles.size>=z}}async loadLegacy(){try{let z=await fetch(this.dataUrl);if(!z.ok)throw Error(`載入題庫失敗: ${z.status} ${z.statusText}`);return this.questionBank=await z.json(),this.loadedBundles.add("legacy"),console.log(`題庫載入完成（傳統模式）: ${this.questionBank.questions.length} 題`),this.questionBank}catch(z){throw console.error("題庫載入錯誤:",z),z}}async load(){if(this.questionBank)return this.questionBank;return this.loadInitial()}isLoaded(){return this.questionBank!==null}getAllQuestions(){return this.questionBank?.questions||[]}filterQuestions(z={}){let J=this.getAllQuestions();if(z.jlpt&&z.jlpt!=="all")J=J.filter((W)=>W.source.jlpt===z.jlpt);if(z.category&&z.category!=="all")J=J.filter((W)=>W.source.category===z.category);if(z.difficulty&&z.difficulty!=="all")J=J.filter((W)=>W.metadata.difficulty===z.difficulty);return J}getRandomQuestion(z={}){let J=this.filterQuestions(z);if(J.length===0)return null;let W=J.filter((V)=>!this.recentIds.has(V.id));if(W.length===0)this.recentIds.clear(),W=J;let Z=Math.floor(Math.random()*W.length),$=W[Z];if(this.recentIds.add($.id),this.recentIds.size>this.maxRecentHistory){let V=this.recentIds.values().next().value;this.recentIds.delete(V)}return $}getQuestionById(z){return this.getAllQuestions().find((J)=>J.id===z)||null}getStats(){return this.questionBank?.stats||null}getJlptLevels(){let z=this.getStats();if(!z?.byJlpt)return["n5","n4","n3","n2","n1"];return Object.keys(z.byJlpt).sort()}getCategories(){let z=this.getStats();if(!z?.byCategory)return[];return Object.keys(z.byCategory).sort()}resetHistory(){this.recentIds.clear()}}var Rz=new S;class r{#z;#J;#W;constructor(z={}){this.#z=z.lang||"ja-JP",this.#J=z.rate||1,this.#W=z.speechSynthesis}get lang(){return this.#z}isSupported(){return this.#W!==void 0&&this.#W!==null}speak(z){return new Promise((J,W)=>{if(!this.isSupported()){J();return}let Z=this.#Z(z);Z.lang=this.#z,Z.rate=this.#J,Z.onend=()=>J(),Z.onerror=($)=>W($),this.#W.speak(Z)})}cancel(){if(this.isSupported())this.#W.cancel()}#Z(z){if(typeof SpeechSynthesisUtterance<"u")return new SpeechSynthesisUtterance(z);return{text:z,lang:"",rate:1,onend:null,onerror:null}}}var B={inputMode:"practice-input-mode",showRomajiHint:"practice-show-hint",jlptFilter:"practice-jlpt-filter"};class a{#z;constructor(z=null){this.#z=z||(typeof localStorage<"u"?localStorage:null)}load(){if(!this.#z)return null;try{let z=this.#z.getItem(B.inputMode),J=this.#z.getItem(B.showRomajiHint),W=this.#z.getItem(B.jlptFilter);return{inputMode:z||"romaji",showRomajiHint:J!=="false",filters:{jlpt:W||"all"}}}catch(z){return console.warn("Failed to load settings from localStorage:",z),null}}save(z){if(!this.#z)return;try{if(z.inputMode!==void 0)this.#z.setItem(B.inputMode,z.inputMode);if(z.showRomajiHint!==void 0)this.#z.setItem(B.showRomajiHint,z.showRomajiHint?"true":"false");if(z.filters?.jlpt!==void 0)this.#z.setItem(B.jlptFilter,z.filters.jlpt)}catch(J){console.warn("Failed to save settings to localStorage:",J)}}clear(){if(!this.#z)return;try{Object.values(B).forEach((z)=>{this.#z.removeItem(z)})}catch(z){console.warn("Failed to clear settings from localStorage:",z)}}get(z){if(!this.#z)return null;let J=B[z];if(!J)return null;try{return this.#z.getItem(J)}catch(W){return null}}set(z,J){if(!this.#z)return;let W=B[z];if(!W)return;try{this.#z.setItem(W,J)}catch(Z){console.warn(`Failed to save ${z} to localStorage:`,Z)}}}class n{#z;#J;#W={};#Z=null;#V;#X=null;#F;#$;#Q;#Y;constructor(z){this.#J=z,this.#z=new I(e,z8),this.#Y=new S;let J=new r;this.#$=new a,D.setDependencies({store:this.#z,questionLoader:this.#Y,speechService:J}),this.#N(),this.#Q=new s(z.keyboardContainer),this.#V=new l({keyboardRenderer:this.#Q,mobileInputElement:z.mobileInputElement}),this.#F=new i(z.textContainer),this.#D()}#N(){this.#W.text=new u(this.#J.textContainer),this.#W.romaji=new c(this.#J.romajiContainer),this.#W.result=new o(this.#J.resultContainer,this.#w())}#w(){if(typeof window>"u")return"";let J=window.location.pathname.match(/^(.*?)\/[^\/]+\/?$/);return J?J[1]:""}#D(){this.#z.subscribe((z,J)=>{this.#P(z,J)})}#P(z,J){switch(J.type){case"COMPLETE_SESSION":this.#v(z.result,z.currentQuestion);break;case"TOGGLE_ROMAJI_HINT":this.#H(z.uiSettings.showRomajiHint);break}}async initialize(){let z=this.#$.load();if(z){if(z.inputMode&&z.inputMode!=="romaji")this.#z.dispatch(Q.setInputMode(z.inputMode));if(z.filters?.jlpt)this.#z.dispatch(Q.setFilter("jlpt",z.filters.jlpt));if(z.showRomajiHint===!1)this.#z.dispatch(Q.toggleRomajiHint())}let J=this.#U();if(J.input==="direct"||J.input==="mobile")this.#z.dispatch(Q.setInputMode("direct"));if(J.text)await this.#O(J.text);else{let W=J.mode==="kana"?"kana":"question";await this.switchPracticeMode(W)}this.#A()}#U(){if(typeof window>"u")return{};let z=new URLSearchParams(window.location.search);return{text:z.get("text"),mode:z.get("mode"),input:z.get("input")}}async#O(z){let{Question:J}=await Promise.resolve().then(() => (E(),N8)),W=J.fromText(z);this.#z.dispatch(Q.loadQuestionSuccess({text:z})),this.#B(W)}async switchPracticeMode(z){try{this.#z.dispatch(Q.setPracticeMode(z)),await D.switchMode(z),await this.loadNextQuestion()}catch(J){console.error("Switch mode failed:",J),this.#z.dispatch(Q.loadQuestionFailure(J.message))}}switchInputMode(z){this.#z.dispatch(Q.setInputMode(z)),this.#$.save({inputMode:z}),this.#T("input",z==="direct"?"direct":null),this.#_(z),this.loadNextQuestion()}setFilter(z,J){this.#z.dispatch(Q.setFilter(z,J)),this.#$.save({filters:{[z]:J}}),this.loadNextQuestion()}toggleRomajiHint(){this.#z.dispatch(Q.toggleRomajiHint());let z=this.#z.getState();this.#$.save({showRomajiHint:z.uiSettings.showRomajiHint})}async loadNextQuestion(){let z=D.getCurrentMode();if(!z)return;this.#L();try{this.#z.dispatch(Q.startLoading()),this.#W.result.hide();let J=await z.loadNextQuestion();this.#B(J)}catch(J){console.error("Load question failed:",J),this.#z.dispatch(Q.loadQuestionFailure(J.message))}}#B(z){let J=D.getCurrentMode(),W=J?J.createSession(z):this.#K(z);if(this.#X=W,J)J.setupSessionListeners(W);W.on("CharacterCompleted",()=>{this.#F.flashSuccess(),this.#G()}),W.on("CharacterMistaken",()=>{this.#F.flashError()}),W.on("RomajiMatched",(Z)=>{this.#R(Z.romaji)}),W.on("SessionCompleted",(Z)=>{this.#z.dispatch(Q.completeSession(Z))}),this.#M(this.#z.getState().inputMode),this.#G()}async#K(z){let{TypingSession:J}=await Promise.resolve().then(() => (k(),W8));return new J(z)}#L(){if(this.#Z)this.#Z.dispose(),this.#Z=null;this.#X=null}#M(z){if(this.#Z)this.#Z.dispose();this.#Z=this.#V.create(z),this.#Z.setSession(this.#X),this.#Z.setUpdateCallback(()=>this.#G()),this.#Z.activate(),this.#_(z)}#_(z){let J=this.#J.container,W=typeof document<"u"?document.body:null,Z=typeof document<"u"?document.getElementById("mobile-input-section"):null,$=this.#J.keyboardContainer;if(z==="direct"){if(J?.classList.add("mode-direct"),W?.classList.add("mode-direct"),Z)Z.style.display="block";if($)$.style.display="none"}else{if(J?.classList.remove("mode-direct"),W?.classList.remove("mode-direct"),Z)Z.style.display="none";if($)$.style.display=""}}#H(z){let J=this.#J.container;if(J)J.classList.toggle("hide-romaji-hint",!z)}#A(){let z=this.#z.getState();this.#H(z.uiSettings.showRomajiHint),this.#_(z.inputMode)}#G(){if(!this.#X)return;let z=this.#z.getState(),J=this.#X.question;if(this.#W.text.render(J,z.currentQuestion),this.#W.romaji.render(J),this.#Z?.updateHighlight)this.#Z.updateHighlight()}#R(z){let J=this.#J.bufferDisplay;if(J)J.textContent=z}#v(z,J){this.#W.result.setNextQuestionCallback(()=>this.loadNextQuestion()),this.#W.result.render(z,J)}#T(z,J){if(typeof window>"u")return;let W=new URL(window.location);if(J)W.searchParams.set(z,J);else W.searchParams.delete(z);window.history.replaceState({},"",W)}getStore(){return this.#z}getState(){return this.#z.getState()}getQuestionLoader(){return this.#Y}dispose(){this.#L(),Object.values(this.#W).forEach((z)=>z.dispose?.()),D.reset()}}var C=null;function v8(z){let J=document.querySelector(".practice-container");if(!J)return;if(document.getElementById("practice-controls"))return;let W=z.getState(),Z=W.inputMode==="romaji"?X.t("mobileMode"):X.t("keyboardMode"),$=W.uiSettings.showRomajiHint?X.t("hideHint"):X.t("showHint"),V=W.practiceMode==="question"?X.t("kanaMode"):X.t("questionMode"),F=W.practiceMode==="kana"?"none":"",w=X.getLanguage(),N=X.getSupportedLanguages().map((f)=>{return`<option value="${f}" ${f===w?"selected":""}>${X.getLanguageName(f)}</option>`}).join(""),_=document.createElement("div");_.id="practice-controls",_.className="practice-controls"+(W.practiceMode==="kana"?" controls-centered":""),_.innerHTML=`
    <div class="control-group" id="jlpt-filter-group" style="display: ${F}">
      <label for="jlpt-filter">${X.t("jlptLabel")}</label>
      <select id="jlpt-filter">
        <option value="all">${X.t("jlptAll")}</option>
        <option value="n5">N5</option>
        <option value="n4">N4</option>
        <option value="n3">N3</option>
        <option value="n2">N2</option>
        <option value="n1">N1</option>
      </select>
    </div>
    <div class="control-group">
      <button id="btn-next" class="control-btn">${X.t("nextQuestion")}</button>
      <button id="btn-toggle-practice" class="control-btn secondary">${V}</button>
      <button id="btn-toggle-input" class="control-btn secondary">${Z}</button>
      <button id="btn-toggle-hint" class="control-btn secondary">${$}</button>
      <select id="lang-selector" class="lang-selector">${N}</select>
    </div>
  `;let P=J.querySelector(".practice-area")||J.firstChild;J.insertBefore(_,P),T8(z)}function T8(z){let J=document.getElementById("jlpt-filter");if(J){let w=z.getState();J.value=w.filters.jlpt,J.addEventListener("change",(N)=>{z.setFilter("jlpt",N.target.value)})}let W=document.getElementById("btn-next");if(W)W.addEventListener("click",()=>{z.loadNextQuestion()});let Z=document.getElementById("btn-toggle-practice");if(Z)Z.addEventListener("click",()=>{let N=z.getState().practiceMode==="question"?"kana":"question";z.switchPracticeMode(N),Z.textContent=N==="question"?X.t("kanaMode"):X.t("questionMode");let _=document.getElementById("jlpt-filter-group"),P=document.getElementById("practice-controls");if(_)_.style.display=N==="kana"?"none":"";if(P)P.classList.toggle("controls-centered",N==="kana")});let $=document.getElementById("btn-toggle-input");if($)$.addEventListener("click",()=>{let N=z.getState().inputMode==="romaji"?"direct":"romaji";z.switchInputMode(N),$.textContent=N==="romaji"?X.t("mobileMode"):X.t("keyboardMode")});let V=document.getElementById("btn-toggle-hint");if(V)V.addEventListener("click",()=>{z.toggleRomajiHint();let w=z.getState();V.textContent=w.uiSettings.showRomajiHint?X.t("hideHint"):X.t("showHint")});let F=document.getElementById("lang-selector");if(F)F.addEventListener("change",(w)=>{X.setLanguage(w.target.value),location.reload()})}function q8(){document.title=`${X.t("pageTitle")} | ${X.t("siteName")}`;let z=document.querySelector(".back-link");if(z)z.textContent=X.t("backToCards");let J=document.querySelector(".mobile-notice p");if(J)J.textContent=X.t("mobileNotice");let W=document.querySelector(".mobile-notice .back-btn");if(W)W.textContent=X.t("backButton");let Z=document.querySelector(".practice-title");if(Z)Z.textContent=X.t("pageTitle");let $=document.getElementById("mobile-kana-input");if($)$.placeholder=X.t("mobileInputPlaceholder");let V=document.querySelector(".mobile-input-hint");if(V)V.textContent=X.t("mobileInputHint");let F=document.querySelector(".practice-footer .hint");if(F)F.textContent=X.t("inputHint");document.documentElement.lang=X.getLanguage()}function E8(z){if(z)z.innerHTML=`<span class="loading">${X.t("loadingQuestions")}</span>`}function j8(z,J){if(z)z.innerHTML=`
      <div class="error-message">
        <p>${J}</p>
        <button onclick="location.reload()">${X.t("reload")}</button>
      </div>
    `}async function L8(){q8();let z=document.getElementById("practice-text"),J=document.getElementById("practice-romaji"),W=document.getElementById("keyboard"),Z=document.querySelector(".practice-container");if(!z||!J||!W){console.error("找不到必要的 DOM 元素");return}let $=document.getElementById("result-container");if(!$)$=document.createElement("div"),$.id="result-container",$.className="result-container",$.style.display="none",Z?.appendChild($);let V=document.getElementById("buffer-display");if(!V)V=document.createElement("div"),V.id="buffer-display",V.className="buffer-display",J.parentNode?.insertBefore(V,J.nextSibling);let F=document.getElementById("mobile-kana-input");E8(z);try{C=new n({container:Z,textContainer:z,romajiContainer:J,resultContainer:$,bufferDisplay:V,keyboardContainer:W,mobileInputElement:F}),await C.initialize(),v8(C),console.log("應用程式初始化完成")}catch(w){console.error("應用程式初始化失敗:",w),j8(z,X.t("initFailed"))}if(typeof window<"u")window.__app=C}if(typeof document<"u")if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",L8);else L8();export{L8 as init,C as app};
